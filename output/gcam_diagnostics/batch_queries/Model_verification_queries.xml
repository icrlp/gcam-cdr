<?xml version="1.0" encoding="UTF-8"?>
<queries>
   
   <aQuery>
       <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
      <supplyDemandQuery title="Final energy by aggregate end-use sector and fuel">
         <axis1 name="fuel">input[@name]</axis1>
         <axis2 name="Year">demand-physical[@vintage]</axis2>
         <xPath buildList="true" dataName="input" group="false" sumAll="false">*[@type='sector' and ((@name='building' or @name='industry' or @name='transportation') or (exists(child::keyword/@final-energy)))]//*[@type='input' and not(@name='trn_pass_road' or @name='limestone' or @name='process heat cement' or @name='industrial energy use' or @name='industrial feedstocks' or @name='renewable' or @name='oil-credits')]/demand-physical[@unit='EJ']/node()</xPath>
         <comments/>
         <labelRewriteList append-values="false">
            <level name="sector">
               <rewrite from="N fertilizer" to="industry"/>
               <rewrite from="agriculture energy use" to="industry"/>
               <rewrite from="boilers general" to="industry"/>
               <rewrite from="machine drive" to="industry"/>
               <rewrite from="process heat primary metals" to="industry"/>
               <rewrite from="industrial energy use" to="industry"/>
               <rewrite from="comm cooling" to="building"/>
               <rewrite from="feedstocks construction" to="industry"/>
               <rewrite from="comm other" to="building"/>
               <rewrite from="resid other appliances" to="building"/>
               <rewrite from="feedstocks chemicals" to="industry"/>
               <rewrite from="process heat cement" to="industry"/>
               <rewrite from="cement" to="industry"/>
               <rewrite from="electrochemical" to="industry"/>
               <rewrite from="feedstocks primary metals" to="industry"/>
               <rewrite from="comm lighting" to="building"/>
               <rewrite from="comm office" to="building"/>
               <rewrite from="other end uses" to="industry"/>
               <rewrite from="construction energy use" to="industry"/>
               <rewrite from="comm cooking" to="building"/>
               <rewrite from="resid appliances" to="building"/>
               <rewrite from="resid hot water" to="building"/>
               <rewrite from="resid heating" to="building"/>
               <rewrite from="industrial feedstocks" to="industry"/>
               <rewrite from="comm heating" to="building"/>
               <rewrite from="boilers pulp paper and wood" to="industry"/>
               <rewrite from="comm ventilation" to="building"/>
               <rewrite from="process heat general" to="industry"/>
               <rewrite from="comm hot water" to="building"/>
               <rewrite from="mining energy use" to="industry"/>
               <rewrite from="limestone feedstocks" to=""/>
               <rewrite from="comm others" to="building"/>
               <rewrite from="resid lighting" to="building"/>
               <rewrite from="resid cooling" to="building"/>
               <rewrite from="resid others" to="building"/>
               <rewrite from="resid other" to="building"/>
               <rewrite from="comm refrigeration" to="building"/>
               <rewrite from="trn_aviation_intl" to="transportation"/>
               <rewrite from="trn_freight" to="transportation"/>
               <rewrite from="trn_freight_road" to="transportation"/>
               <rewrite from="trn_pass" to="transportation"/>
               <rewrite from="trn_pass_road" to="transportation"/>
               <rewrite from="trn_pass_road_LDV" to="transportation"/>
               <rewrite from="trn_pass_road_LDV_2W" to="transportation"/>
               <rewrite from="trn_pass_road_LDV_4W" to="transportation"/>
               <rewrite from="trn_shipping_intl" to="transportation"/>
            </level>
            <level name="input">
               <rewrite from="traditional biomass" to="7 trad biomass"/>
               <rewrite from="H2 enduse" to="6 hydrogen"/>
               <rewrite from="delivered biomass" to="4 biomass"/>
               <rewrite from="refined liquids enduse" to="1 liquids"/>
               <rewrite from="elect_td_bld" to="5 electricity"/>
               <rewrite from="elect_td_trn" to="5 electricity"/>
               <rewrite from="delivered coal" to="3 coal"/>
               <rewrite from="elect_td_ind" to="5 electricity"/>
               <rewrite from="wholesale gas" to="2 gas"/>
               <rewrite from="refined liquids industrial" to="1 liquids"/>
               <rewrite from="delivered gas" to="2 gas"/>
               <rewrite from="district heat" to="8 district heat"/>
            </level>
         </labelRewriteList>
      </supplyDemandQuery>
   </aQuery>
      
   <aQuery>
      <region name="USA"/>
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
      <supplyDemandQuery title="Industry feedstocks (liquids only)">
         <axis1 name="input">input</axis1>
         <axis2 name="Year">demand-physical[@vintage]</axis2>
         <xPath buildList="true" dataName="input" group="false" sumAll="true">*[@type = 'sector' (:collapse:) and contains(@name,'feedstock')]//*[@type='input' and (@name='refined liquids industrial')]/demand-physical/node()</xPath>
         <comments/>
      </supplyDemandQuery>
   </aQuery>
      
      <aQuery>
         <region name="USA"/>
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
         <supplyDemandQuery title="Refined liquid fuel production by technology">
            <axis1 name="technology">technology</axis1>
            <axis2 name="Year">physical-output[@vintage]</axis2>
            <xPath buildList="true" dataName="output" group="false" sumAll="false">*[@type = 'sector' and ((@name='refined liquids enduse' or @name='refined liquids industrial' or @name='refining'))]/*[@type = 'subsector']/*[@type = 'technology' and not (@name='refined liquids enduse' or @name = 'refined liquids industrial')]//output-primary[@type='output' (:collapse:)]/physical-output/node()</xPath>
            <comments/>
         </supplyDemandQuery>
      </aQuery>
      
      <aQuery>
         <region name="USA"/>
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
         <gdpQueryBuilder title="GDP by region">
            <axis1 name="region">region</axis1>
            <axis2 name="Year">gdp-mer</axis2>
            <xPath buildList="true" dataName="gdp-mer" group="false" sumAll="false">GDP/gdp-mer/text()</xPath>
            <comments/>
         </gdpQueryBuilder>
      </aQuery>
      
      <aQuery>
         <region name="USA"/>
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
         <demographicsQuery title="Population by region">
            <axis1 name="region">region</axis1>
            <axis2 name="Year">populationMiniCAM</axis2>
            <xPath buildList="true" dataName="total-population" group="false" sumAll="false">demographics/populationMiniCAM/total-population/node()</xPath>
            <comments/>
         </demographicsQuery>
      </aQuery>
      
      <aQuery>
         <region name="USA" />
         <region name="Africa_Eastern" />
         <region name="Africa_Northern" />
         <region name="Africa_Southern" />
         <region name="Africa_Western" />
         <region name="Australia_NZ" />
         <region name="Brazil" />
         <region name="Canada" />
         <region name="Central America and Caribbean" />
         <region name="Central Asia" />
         <region name="China" />
         <region name="EU-12" />
         <region name="EU-15" />
         <region name="Europe_Eastern" />
         <region name="Europe_Non_EU" />
         <region name="European Free Trade Association" />
         <region name="India" />
         <region name="Indonesia" />
         <region name="Japan" />
         <region name="Mexico" />
         <region name="Middle East" />
         <region name="Pakistan" />
         <region name="Russia" />
         <region name="South Africa" />
         <region name="South America_Northern" />
         <region name="South America_Southern" />
         <region name="South Asia" />
         <region name="South Korea" />
         <region name="Southeast Asia" />
         <region name="Taiwan" />
         <region name="Argentina" />
         <region name="Colombia" />
       <supplyDemandQuery title="Primary energy with CCS (Direct Equivalent)">
         <axis1 name="fuel">input[@name]</axis1>
         <axis2 name="Year">demand-physical[@vintage]</axis2>
         <xPath buildList="true" dataName="input" group="false" sumAll="false"><![CDATA[
               declare function local:append-heirarchy($parent as node(), $append as node()*) as node() {
	       	 		 let $scn := $parent/ancestor::scenario,
	       			   	  $rgn := $parent (: /ancestor::region :)
	       			   return
	       			   	  document { element scenario {
	       			 	  					$scn/@*,
	       			 						element region {
	       			 							$rgn/@*,
	       			 							$append
	       			 						}
	       			 	  				}
	       				}
	       	 		 (: I can get by with just the scenario and region
	       			 let $new_node := element {local-name($parent)} {$parent/@*, $append} 	
	       	 		 return
	       	 		 if(local-name($parent) != 'scenario')
	       	 		 then local:append-heirarchy($parent/parent::*, $new_node)
	       	 		 else document { $new_node } :)
	       	 	 }; 
	       	 	 declare function local:generate-sector-input-coefs($outputNameQueue as xs:string*, $currTree as node(), $coefs as node()*, $is_usa as xs:boolean) as node()* {
                 if(empty($outputNameQueue)) then $coefs
                 else if( exists($coefs[@name = $outputNameQueue[1]]) or exists(index-of(('biomass',
'traded unconventional oil', 'regional corn for ethanol', 'regional biomassOil', 'regional sugar for ethanol', 'regional sugarbeet for ethanol'),
$outputNameQueue[1])) or not($currTree/*[@type='sector' and @name=$outputNameQueue[1]]))
then 
(:if(not($is_usa) and string-length($currTree/@name) = 2) then
local:trace-inputs($outputName, $currTree/parent::*/*[@type='region' and @name='USA'], $outputs, true())
else:)
local:generate-sector-input-coefs(remove($outputNameQueue, 1), $currTree, $coefs, $is_usa)
	       				else
                    let $outputName := $outputNameQueue[1],
                        $newOutputNameQueue := remove($outputNameQueue, 1),
                        $useOutputs := $currTree//output-primary[@type='output' and @name=$outputName],
                        $useInputs := for $out in $useOutputs[not(following-sibling::keyword[exists(@primary-renewable)])]
                                      return $out/following-sibling::*[@type='input' and not(@name='oil-credits')],
                        $renewOutputs := for $out in $useOutputs[following-sibling::keyword[exists(@primary-renewable)]]
                                         return element output {
                                             attribute name { $out/following-sibling::keyword/@primary-renewable },
                                             $out/child::*
                                         },
                        $totalOutputSum := for $vintage in distinct-values($useOutputs/physical-output/@vintage)
                                          return element output {
                                                     attribute vintage { $vintage },
                                                     text {
                                                         sum($useOutputs/physical-output[@vintage=$vintage])
                                                     }
                                                 },
                       $new_coefs := $coefs | element sector {
                                            attribute name { $outputName },
                                            for $input in distinct-values($useInputs/@name)
                                            return element input {
                                                       attribute name { $input },
                                                       for $outputSum in $totalOutputSum
                                                       let $inputSum := sum($useInputs[@name=$input]/demand-physical[@vintage=$outputSum/@vintage])
                                                       where $inputSum > 0
                                                       return element coef {
                                                                  attribute vintage { $outputSum/@vintage },
                                                                  text { $inputSum div $outputSum }
                                                              }
                                                    },
                                            for $input in distinct-values($renewOutputs/@name)
                                            return element input {
                                                       attribute name { concat($input, ' renewable') },
                                                       attribute is-renewable { true() },
                                                       for $outputSum in $totalOutputSum
                                                       let $inputSum := sum($renewOutputs[@name=$input]/physical-output[@vintage=$outputSum/@vintage])
                                                       where $inputSum > 0
                                                       return element coef {
                                                                  attribute vintage { $outputSum/@vintage },
                                                                  text { $inputSum div $outputSum }
                                                              }
                                                    }
                                        }
                        return 
                              local:generate-sector-input-coefs(distinct-values(($newOutputNameQueue, $useInputs/@name)), $currTree, $new_coefs, $is_usa)
		};
        declare function local:generate-ccs-coefs($currTree as node(), $coefs as node()*) as node()* {
            for $sector in $coefs/@name
            let $currSector := $currTree/*[@type='sector' and @name=$sector],
                $useInputs := $currSector//*[@type='technology' and not(contains(@name, 'CCS')) and not(child::keyword/@primary-renewable)]/*[@type='input' and not(@name = 'oil-credits')],
                $useInputsCCS := $currSector//*[@type='technology' and contains(@name, 'CCS')]/*[@type='input' and not(@name = 'oil-credits')],
                $totalOutputSum := for $vintage in distinct-values($useInputs/demand-physical/@vintage | $useInputsCCS/demand-physical/@vintage)
                                          return element output {
                                                     attribute vintage { $vintage },
                                                     text {
                                                         sum($currSector//output-primary/physical-output[@vintage=$vintage])
                                                     }
                                                 }
            return if(exists($useInputsCCS)) then
                element sector {
                                            attribute name { $sector },
                                            $coefs[@name=$sector]/input[@is-renewable],
                                            for $input in distinct-values(($useInputs/@name, $useInputsCCS/@name))
                                            return element input {
                                                       attribute name { $input },
                                                       for $outputSum in $totalOutputSum
                                                       let $inputSum := sum($useInputs[@name=$input]/demand-physical[@vintage=$outputSum/@vintage]),
                                                           $inputSumCCS := sum($useInputsCCS[@name=$input]/demand-physical[@vintage=$outputSum/@vintage])
                                                       return (element coef {
                                                                  attribute vintage { $outputSum/@vintage },
                                                                  text { $inputSum div $outputSum }
                                                              },
                                                              element coef_ccs {
                                                                  attribute vintage { $outputSum/@vintage },
                                                                  text { $inputSumCCS div $outputSum }
                                                              })
                                                    }
                                        }
                    else
                        $coefs[@name=$sector]
        };
        declare function local:apply-coefs($outputName as xs:string, $outputs as node()*, $coefs as node()*, $isCCS as xs:boolean) as node()* {
            if(exists($coefs[@name=$outputName]) and sum($outputs) > 0.001) then
                for $input in $coefs[@name=$outputName]/input
                return local:apply-coefs($input/@name,
                    for $vintage in distinct-values($outputs/@vintage)
                    let $outputThisVintage := $outputs[@vintage=$vintage],
                        $firstOutput := $outputThisVintage[1],
                        $outputSum := sum($outputThisVintage),
                        $coefThisVintage := $input/coef[@vintage=$vintage]
                    where $coefThisVintage > 0
	       		    return element { local-name($firstOutput) } {
	       				$firstOutput/@*,
                        text{ $outputSum * $coefThisVintage }
                        }, $coefs, $isCCS)
                    | local:apply-coefs($input/@name,
                    for $vintage in distinct-values($outputs/@vintage)
                    let $outputThisVintage := $outputs[@vintage=$vintage],
                        $firstOutput := $outputThisVintage[1],
                        $outputSum := sum($outputThisVintage),
                        $coefThisVintage := $input/coef_ccs[@vintage=$vintage]
                    where exists($coefThisVintage) and $coefThisVintage > 0
	       		    return element { local-name($firstOutput) } {
	       				$firstOutput/@*,
                        text{ $outputSum * $coefThisVintage }
	       			}, $coefs, true())
            else if( sum($outputs) > 0.001) then
                element input {
                    attribute name { if($isCCS) then concat($outputName, ' CCS') else $outputName },
                    attribute type { 'input' },
                    (: $outputs :) (: TODO: not sure why this doesn't work and we need to create these explicitly :)
                    for $o in $outputs
                    return element demand-physical { $o/@*, text{ $o/text() } }
                }
            else
                (: These are the residuals from chasing simulenaties, I've left this here
                   for debuging purposes :)
                element input {
                    attribute name { $outputName },
                    attribute type { 'input' } (:,
                    $outputs :)
                }
        };
		declare function local:run-input-by-primary($scenarios as xs:string*, $regions as xs:string*, $collection as xs:string) as node()* { 	
			 	 unordered { 	
			 	 let $regionsG := if(not($regions[1] = 'Global'))
			 	 		  then $regions
			 	 		  else distinct-values(collection($collection)/scenario/world/*[@type='region']/@name)
			 	 return
			 	 for $scenario in $scenarios, 	    
			 	 $region in $regionsG 	
			 	 let $scenario_split := tokenize($scenario, ' '), 	    
				 $currTree := collection($collection)/scenario[@name = $scenario_split[1] and @date = $scenario_split[2]]/world/*[@type='region' and @name=$region],
                 $currInputs := $currTree/*[@type='sector' and (@name='unconventional oil production' or exists(child::keyword/@final-energy))]//*[@type='input' and empty(index-of(('trn_pass_road', 'limestone', 'process heat cement', 'industrial energy use', 'industrial feedstocks', 'renewable', 'trn_freight_road', 'trn_pass_road_LDV', 'trn_pass_road_LDV_2W', 'trn_pass_road_LDV_4W', 'unconventional oil', 'oil-credits'), @name))],
                 $coefs := local:generate-sector-input-coefs(distinct-values($currInputs/@name), $currTree, (), false()),
                 $ccs_coefs := local:generate-ccs-coefs($currTree, $coefs)
				 return 
				    for $inputName in distinct-values($currInputs/@name)
				    return local:append-heirarchy($currTree, local:apply-coefs($inputName, $currInputs[@name=$inputName]/demand-physical, $ccs_coefs, false()))//text()
			 	 } 
	 	 };
		 local:run-input-by-primary((:scenarios:), (:regions:), (:collection:))
         ]]></xPath>
         <comments>WARNING: Results are slightly inflated due to improper secondary-output accounting</comments>
         <labelRewriteList append-values="false">
            <level name="input">
               <rewrite from="traditional biomass" to="j traditional biomass"/>
               <rewrite from="geothermal-elect" to="i geothermal"/>
               <rewrite from="geothermal-elect renewable" to="i geothermal"/>
               <rewrite from="geothermal-elect renewable CCS" to="i geothermal"/>
               <rewrite from="biomass" to="d biomass"/>
               <rewrite from="biomass CCS" to="d biomass CCS"/>
               <rewrite from="traded biomass" to="d biomass"/>
               <rewrite from="traded biomass CCS" to="d biomass CCS"/>
               <rewrite from="regional biomassOil" to="d biomass"/>
               <rewrite from="regional corn for ethanol" to="d biomass"/>
               <rewrite from="regional corn for ethanol CCS" to="d biomass CCS"/>
               <rewrite from="regional sugar for ethanol" to="d biomass"/>
               <rewrite from="regional sugarbeet for ethanol" to="d biomass"/>
               <rewrite from="nuclear-H2 renewable" to="e nuclear"/>
               <rewrite from="natural gas" to="b natural gas"/>
               <rewrite from="natural gas CCS" to="b natural gas CCS"/>
               <rewrite from="wind-elect" to="g wind"/>
               <rewrite from="wind-elect renewable" to="g wind"/>
               <rewrite from="wind-elect renewable CCS" to="g wind"/>
               <rewrite from="exotic-elect" to="j breakthrough"/>
               <rewrite from="elect_td_ind" to=""/>
               <rewrite from="solar-elect renewable" to="h solar"/>
               <rewrite from="solar-elect renewable CCS" to="h solar"/>
               <rewrite from="solar-H2 renewable" to="h solar"/>
               <rewrite from="regional natural gas" to=""/>
               <rewrite from="coal" to="c coal"/>
               <rewrite from="coal CCS" to="c coal CCS"/>
               <rewrite from="crude oil" to="a oil"/>
               <rewrite from="crude oil CCS" to="a oil CCS"/>
               <rewrite from="hydro-elect renewable" to="f hydro"/>
               <rewrite from="hydro-elect renewable CCS" to="f hydro"/>
               <rewrite from="nuclear-elect renewable" to="e nuclear"/>
               <rewrite from="nuclear-elect renewable CCS" to="e nuclear"/>
               <rewrite from="traded unconventional oil" to="a oil"/>
               <rewrite from="traded unconventional oil CCS" to="a oil CCS"/>
               <rewrite from="wind-H2 renewable" to="g wind"/>
               <rewrite from="regional biomassOil CCS" to="d biomass CCS"/>
               <rewrite from="regional sugar for ethanol CCS" to="d biomass CCS"/>
               <rewrite from="limestone" to=""/>
               <rewrite from="renewable" to=""/>
               <rewrite from="seawater" to=""/>
               <rewrite from="water consumption" to=""/>
               <rewrite from="water withdrawals" to=""/>
               <rewrite from="seawater CCS" to=""/>
               <rewrite from="water consumption CCS" to=""/>
               <rewrite from="water withdrawals CCS" to=""/>
            </level>
         </labelRewriteList>
     </supplyDemandQuery>


      </aQuery>
      
      <aQuery>
         <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
       <supplyDemandQuery title="Electricity generation by aggregate technology">
           <axis1 name="technology">technology</axis1>
           <axis2 name="Year">physical-output[@vintage]</axis2>
           <xPath buildList="true" dataName="output" group="false" sumAll="false">*[@type = 'sector' (: collapse :) and (@name='electricity' or @name='elect_td_bld' or @name='industrial energy use' )]//*[@type = 'technology' and not (@name='elect_td_bld' or @name='electricity')]/*[@type='output' (:collapse:) and (@name='electricity' or @name='elect_td_bld')]/physical-output/node()</xPath>
           <comments/>
           <labelRewriteList append-values="false">
               <level name="technology">
                   <rewrite from="coal (IGCC)" to="a Coal"/>
                   <rewrite from="coal (conv pul)" to="a Coal"/>
                   <rewrite from="coal (IGCC CCS)" to="b Coal w/CCS"/>
                   <rewrite from="coal (conv pul CCS)" to="b Coal w/CCS"/>
                   <rewrite from="gas (CC)" to="c Gas"/>
                   <rewrite from="gas (steam/CT)" to="c Gas"/>
                   <rewrite from="gas (CC CCS)" to="d Gas w/CCS"/>
                   <rewrite from="refined liquids (CC)" to="e Oil"/>
                   <rewrite from="refined liquids (steam/CT)" to="e Oil"/>
                   <rewrite from="refined liquids (CC CCS)" to="f Oil w/CCS"/>
                   <rewrite from="biomass (IGCC)" to="g Biomass"/>
                   <rewrite from="biomass (conv)" to="g Biomass"/>
                   <rewrite from="biomass (IGCC CCS)" to="h Biomass w/CCS"/>
                   <rewrite from="biomass (conv CCS)" to="h Biomass w/CCS"/>
                   <rewrite from="Gen_III" to="i Nuclear"/>
                   <rewrite from="Gen_II_LWR" to="i Nuclear"/>
                   <rewrite from="geothermal" to="j Geothermal"/>
                   <rewrite from="hydro" to="k Hydro"/>
                   <rewrite from="wind" to="l Wind"/>
                   <rewrite from="wind_storage" to="l Wind"/>
                   <rewrite from="CSP" to="m Solar"/>
                   <rewrite from="CSP_storage" to="m Solar"/>
                   <rewrite from="PV" to="m Solar"/>
                   <rewrite from="PV_storage" to="m Solar"/>
                   <rewrite from="rooftop_pv" to="m Solar"/>
                   <rewrite from="biomass cogen" to="n CHP"/>
                   <rewrite from="coal cogen" to="n CHP"/>
                   <rewrite from="gas cogen" to="n CHP"/>
                   <rewrite from="refined liquids cogen" to="n CHP"/>
                   <rewrite from="hydrogen cogen" to="n CHP"/>
               </level>
           </labelRewriteList>
       </supplyDemandQuery>
      </aQuery>
      
      
      <aQuery>
         <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
         <supplyDemandQuery title="Hydrogen production by technology">
            <axis1 name="technology">technology</axis1>
            <axis2 name="Year">physical-output[@vintage]</axis2>
            <xPath buildList="true" dataName="output" group="false" sumAll="false">*[@type = 'sector' and ((@name='H2 Central Production' or @name='H2 Forecourt Production' or @name='H2 central production' or @name='H2 forecourt production') )]/*[@type = 'subsector']//*[@type = 'technology']//*[@type='output']/physical-output/node()</xPath>
            <comments/>
         </supplyDemandQuery>
      </aQuery>
      
      <aQuery>
         <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
         <supplyDemandQuery title="Biomass Consumption by use">
            <axis1 name="sector">sector</axis1>
            <axis2 name="Year">demand-physical[@vintage]</axis2>
            <chartLabelColumn>demand</chartLabelColumn>
            <xPath buildList="true" dataName="demand-physical[@vintage]" group="false" sumAll="false">*[@type='sector']//*[@type='input' and (@name='regional biomass' or @name='delivered biomass')]/demand-physical/node()</xPath>
            <comments/>
         <labelRewriteList append-values="true">
               <level name="sector">
                  <rewrite to="" from="delivered biomass"/>
                  <rewrite to="building" from="comm cooling"/>
                  <rewrite to="building" from="comm heating"/>
                  <rewrite to="building" from="comm others"/>
                  <rewrite to="building" from="resid cooling"/>
                  <rewrite to="building" from="resid heating"/>
                  <rewrite to="building" from="resid others"/>
                  <rewrite to="industry" from="process heat cement"/>
                  <rewrite to="electricity" from="base load generation"/>
                  <rewrite to="electricity" from="intermediate generation"/>
                  <rewrite to="electricity" from="elec_biomass (IGCC)"/>
                  <rewrite to="electricity" from="elec_biomass (conv)"/>
                  <rewrite to="hydrogen" from="H2 central production"/>
                  <rewrite to="hydrogen" from="H2 Central Production"/>
                  <rewrite to="refining" from="refined liquids enduse"/>
                  <rewrite to="refining" from="refined liquids industrial"/>
                  <rewrite to="industry" from="industrial energy use"/>
                  <rewrite to="industry" from="industrial feedstocks"/>
               </level>
            </labelRewriteList>
         </supplyDemandQuery>
      </aQuery>

      <aQuery>
         <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
       <supplyDemandQuery title="Electricity generation by technology (inc solar roofs)">
           <axis1 name="technology">technology</axis1>
           <axis2 name="Year">physical-output[@vintage]</axis2>
           <xPath buildList="true" dataName="output" group="false" sumAll="false">*[@type = 'sector' (: collapse :) and (@name='electricity' or @name='elect_td_bld' or @name='industrial energy use')]//*[@type = 'technology' and not (@name='elect_td_bld' or @name='electricity')]/*[@type='output' (:collapse:) and (@name='electricity' or @name='elect_td_bld')]/physical-output/node()</xPath>
           <comments/>
       </supplyDemandQuery>
      </aQuery>
   

   <aQuery>
         <region name="USA" />
         <region name="Africa_Eastern" />
         <region name="Africa_Northern" />
         <region name="Africa_Southern" />
         <region name="Africa_Western" />
         <region name="Australia_NZ" />
         <region name="Brazil" />
         <region name="Canada" />
         <region name="Central America and Caribbean" />
         <region name="Central Asia" />
         <region name="China" />
         <region name="EU-12" />
         <region name="EU-15" />
         <region name="Europe_Eastern" />
         <region name="Europe_Non_EU" />
         <region name="European Free Trade Association" />
         <region name="India" />
         <region name="Indonesia" />
         <region name="Japan" />
         <region name="Mexico" />
         <region name="Middle East" />
         <region name="Pakistan" />
         <region name="Russia" />
         <region name="South Africa" />
         <region name="South America_Northern" />
         <region name="South America_Southern" />
         <region name="South Asia" />
         <region name="South Korea" />
         <region name="Southeast Asia" />
         <region name="Taiwan" />
         <region name="Argentina" />
         <region name="Colombia" />
<supplyDemandQuery title="CO2 Emissions by enduse">
         <axis1 name="sector">sector[@name]</axis1>
         <axis2 name="Year">emissions[@year]</axis2>
         <xPath buildList="true" dataName="input" group="false" sumAll="false"><![CDATA[
               declare function local:append-heirarchy($parent as node(), $append as node()*) as node() {
	       	 		 let $scn := $parent/ancestor::scenario,
	       			   	  $rgn := $parent (: /ancestor::region :)
	       			   return
	       			   	  document { element scenario {
	       			 	  					$scn/@*,
	       			 						element region {
	       			 							$rgn/@*,
	       			 							$append
	       			 						}
	       			 	  				}
	       				}
	       	 		 (: I can get by with just the scenario and region
	       			 let $new_node := element {local-name($parent)} {$parent/@*, $append} 	
	       	 		 return
	       	 		 if(local-name($parent) != 'scenario')
	       	 		 then local:append-heirarchy($parent/parent::*, $new_node)
	       	 		 else document { $new_node } :)
	       	 	 }; 
	       	 	 declare function local:generate-sector-output-coefs($inputNameQueue as xs:string*, $currTree as node(), $coefs as node()*, $is_usa as xs:boolean) as node()* {
                 if(empty($inputNameQueue)) then $coefs
                 else if( exists($coefs[@name = $inputNameQueue[1]]) or exists(index-of(('unconventional oil production', "electricity", "cement", "N fertilizer"),
$inputNameQueue[1])) or not($currTree/*[@type='sector' and @name=$inputNameQueue[1]]))
then 
local:generate-sector-output-coefs(remove($inputNameQueue, 1), $currTree, $coefs, $is_usa)
	       				else
                    let $inputName := $inputNameQueue[1],
                        $newInputNameQueue := remove($inputNameQueue, 1),
                        $useInputs := $currTree//*[@type='input' and @name=$inputName],
                        $useSectors := distinct-values($useInputs/ancestor::*[@type='sector']/@name),
                        $totalInputSum := for $vintage in distinct-values($useInputs/demand-physical/@vintage)
                                          return element input {
                                                     attribute vintage { $vintage },
                                                     text {
                                                         sum($useInputs/demand-physical[@vintage=$vintage])
                                                     }
                                                 },
                       $new_coefs := if(empty($useSectors)) then
                                         $coefs
                                     else
                                         $coefs | element sector {
                                            attribute name { $inputName },
                                            for $output in $useSectors
                                            return element output {
                                                       attribute name { $output },
                                                       for $inputSum in $totalInputSum
                                                       let $outputSum := sum($useInputs[ancestor::*[@type='sector' and @name=$output]]/demand-physical[@vintage=$inputSum/@vintage])
                                                       return element coef {
                                                                  attribute vintage { $inputSum/@vintage },
                                                                  text { $outputSum div $inputSum }
                                                              }
                                                    }
                                        }
                        return 
                              local:generate-sector-output-coefs(distinct-values(($newInputNameQueue, $useSectors)), $currTree, $new_coefs, $is_usa)
		};
        declare function local:apply-coefs($outputName as xs:string, $emissions as node()*, $coefs as node()*) as node()* {
            if(exists($coefs[@name=$outputName]) and abs(sum($emissions)) > 0.001) then
                for $output in $coefs[@name=$outputName]/output
                return local:apply-coefs($output/@name,
                    for $year in distinct-values($emissions/@year)
                    let $emissThisVintage := $emissions[@year=$year],
                        $firstEmiss := $emissThisVintage[1],
                        $emissSum := sum($emissThisVintage),
                        $coefThisVintage := $output/coef[@vintage=$year]
                    where $coefThisVintage > 0
                    return element { local-name($firstEmiss) } {
                            $firstEmiss/@*,
                            text{ $emissSum * $coefThisVintage }
                        }
	       			, $coefs)
            else if( abs(sum($emissions)) > 0.001) then
                element sector {
                    attribute name { $outputName },
                    attribute type { 'sector' },
                    (: $emissions :) (: TODO: not sure why this doesn't work and we need to create these explicitly :)
                    for $e in $emissions
                    return element emissions { $e/@*, text{ $e/text() } }
                }
            else
                (: These are the residuals from chasing simulenaties, I've left this here
                   for debuging purposes :)
                element sector {
                    attribute name { $outputName },
                    attribute type { 'sector' }(:,
                    $emissions:)
                }
        };
		declare function local:run-emiss-by-enduse($scenarios as xs:string*, $regions as xs:string*, $collection as xs:string) as node()* { 	
			 	 unordered { 	
			 	 let $regionsG := if(not($regions[1] = 'Global'))
			 	 		  then $regions
			 	 		  else distinct-values(collection($collection)/scenario/world/*[@type='region']/@name)
			 	 return
			 	 for $scenario in $scenarios, 	    
			 	 $region in $regionsG 	
			 	 let $scenario_split := tokenize($scenario, ' '), 	    
				 $currTree := collection($collection)/scenario[@name = $scenario_split[1] and @date = $scenario_split[2]]/world/*[@type='region' and @name=$region],
                 $currEmissSectors := $currTree/*[@type='sector' and descendant::CO2],
                 $coefs := local:generate-sector-output-coefs(distinct-values($currEmissSectors/@name), $currTree, (), false())
				 return
				    for $sectorName in distinct-values($currEmissSectors/@name)
                    return local:append-heirarchy($currTree, local:apply-coefs($sectorName, $currEmissSectors[@name=$sectorName]//CO2/emissions, $coefs))//text()
			 	 } 
	 	 };
		 local:run-emiss-by-enduse((:scenarios:), (:regions:), (:collection:))
         ]]></xPath>
         <comments/>
         <labelRewriteList append-values="false">
            <level name="sector">
               <rewrite from="N fertilizer" to="industry"/>
               <rewrite from="unconventional oil production" to="industry"/>
               <rewrite from="comm cooling" to="buildings"/>
               <rewrite from="comm heating" to="buildings"/>
               <rewrite from="comm others" to="buildings"/>
               <rewrite from="resid cooling" to="buildings"/>
               <rewrite from="resid heating" to="buildings"/>
               <rewrite from="resid others" to="buildings"/>
               <rewrite to="transportation" from="trn_aviation_intl"/>
               <rewrite to="transportation" from="trn_freight"/>
               <rewrite to="transportation" from="trn_freight_road"/>
               <rewrite to="transportation" from="trn_pass_road"/>
               <rewrite to="transportation" from="trn_pass_road_bus"/>
               <rewrite to="transportation" from="trn_pass_road_LDV"/>
               <rewrite to="transportation" from="trn_pass_road_LDV_4W"/>
               <rewrite to="transportation" from="trn_pass_road_LDV_2W"/>
               <rewrite to="transportation" from="trn_passenger"/>
               <rewrite to="transportation" from="trn_pass"/>
               <rewrite to="transportation" from="trn_shipping_intl"/>
           </level>
       </labelRewriteList>
      </supplyDemandQuery>
   </aQuery>
   
   <aQuery>
      <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
      <emissionsQueryBuilder title="CO2 emissions by region">
      	<axis1 name="region">region</axis1>
      	<axis2 name="Year">emissions</axis2>
      	<xPath buildList="true" dataName="emissions" group="false" sumAll="false">*[@type = 'sector' (:collapse:)]//*[@type = 'GHG' and ((@name='CO2') )]/emissions/node()</xPath>
      	<comments/>
      </emissionsQueryBuilder>
      </aQuery>   
   
      <aQuery>
      <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
          <query title="Aggregated Land Allocation">
              <axis1 name="land-allocation">LandLeaf[@crop]</axis1>
              <axis2 name="Year">land-allocation[@year]</axis2>
              <xPath buildList="true" dataName="LandLeaf" group="false" sumAll="false">/LandNode[@name='root' or @type='LandNode' (:collapse:)]//land-allocation/text()</xPath>
              <comments/>
              <labelRewriteList append-values="false">
                  <level name="LandLeaf">
                      <rewrite from="Corn" to="crops"/>
                      <rewrite from="FiberCrop" to="crops"/>
                      <rewrite from="FodderGrass" to="crops"/>
                      <rewrite from="FodderHerb" to="crops"/>
                      <rewrite from="Forest" to="forest (managed)"/>
                      <rewrite from="Grassland" to="grass"/>
                      <rewrite from="MiscCrop" to="crops"/>
                      <rewrite from="OilCrop" to="crops"/>
                      <rewrite from="OtherArableLand" to="otherarable"/>
                      <rewrite from="OtherGrain" to="crops"/>
                      <rewrite from="PalmFruit" to="crops"/>
                      <rewrite from="Pasture" to="pasture (grazed)"/>
                      <rewrite from="ProtectedGrassland" to="grass"/>
                      <rewrite from="ProtectedShrubland" to="shrubs"/>
                      <rewrite from="ProtectedUnmanagedForest" to="forest (unmanaged)"/>
                      <rewrite from="ProtectedUnmanagedPasture" to="pasture (other)"/>
                      <rewrite from="Rice" to="crops"/>
                      <rewrite from="RockIceDesert" to="rock and desert"/>
                      <rewrite from="Root_Tuber" to="crops"/>
                      <rewrite from="Shrubland" to="shrubs"/>
                      <rewrite from="SugarCrop" to="crops"/>
                      <rewrite from="Tundra" to="tundra"/>
                      <rewrite from="UnmanagedForest" to="forest (unmanaged)"/>
                      <rewrite from="UnmanagedPasture" to="pasture (other)"/>
                      <rewrite from="UrbanLand" to="urban"/>
                      <rewrite from="Wheat" to="crops"/>
                      <rewrite from="biomass_grass" to="biomass"/>
                      <rewrite from="biomass_tree" to="biomass"/>
                  </level>
              </labelRewriteList>
          </query>


      </aQuery>
   
   <aQuery>
      <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Indonesia" />
       <region name="Russia" />
       <region name="South Korea" />
      <supplyDemandQuery title="Regional energy costs">
          <axis1 name="sector">sector</axis1>
          <axis2 name="Year">cost</axis2>
          <xPath buildList="true" dataName="cost" group="false" sumAll="false">*[@type = 'sector' and ((@name='regional oil' or @name='regional natural gas' or @name='regional coal' or @name='regional biomass' or @name='nuclearFuelGenIII' or @name='electricity'))]/cost/text()</xPath>
          <comments/>
      </supplyDemandQuery>
   </aQuery>
   <aQuery>
      <region name="USA" />
       <region name="Canada" />
       <region name="Western Europe" />
       <region name="Japan" />
       <region name="Australia_NZ" />
       <region name="Former Soviet Union" />
       <region name="China" />
       <region name="Middle East" />
       <region name="Africa" />
       <region name="Latin America" />
       <region name="Southeast Asia" />
       <region name="Eastern Europe" />
       <region name="Korea" />
       <region name="India" />
       <region name="Africa_Eastern" />
       <region name="Africa_Northern" />
       <region name="Africa_Southern" />
       <region name="Africa_Western" />
       <region name="Brazil" />
       <region name="Central America and Caribbean" />
       <region name="Central Asia" />
       <region name="EU-12" />
       <region name="EU-15" />
       <region name="Europe_Eastern" />
       <region name="Europe_Non_EU" />
       <region name="European Free Trade Association" />
       <region name="Indonesia" />
       <region name="Mexico" />
       <region name="Pakistan" />
       <region name="Russia" />
       <region name="South Africa" />
       <region name="South America_Northern" />
       <region name="South America_Southern" />
       <region name="Argentina" />
       <region name="Colombia" />
       <region name="South Asia" />
       <region name="South Korea" />
       <region name="Taiwan" />
       <supplyDemandQuery title="Regional oil production by fuel">
           <axis1 name="fuel">technology</axis1>
           <axis2 name="Year">physical-output[@vintage]</axis2>
           <xPath buildList="true" dataName="output" group="false" sumAll="false">*[@type = 'sector' (:collapse:) and @name='regional oil']//*[@type = 'technology']/*[@type='output' (:collapse:)]/physical-output/node()</xPath>
           <comments/>
       </supplyDemandQuery>
   </aQuery>
</queries>
   
